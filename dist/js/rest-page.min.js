class DBHelper{static fetchRestaurants(e){fetch("http://localhost:1337/restaurants").then(function(e){return e.json()}).then(function(t){e(null,t),console.log("Sucess:",t)})}static fetchReviews(e){fetch("http://localhost:1337/reviews").then(function(e){return e.json()}).then(function(t){console.log("Review:",t),e(null,t)})}static fetchReviewsByRestaurantId(e,t){DBHelper.fetchReviews((e,n)=>{if(e)t(e,null);else{let e=n.filter(e=>e.restaurant_id==getParameterByName("id"));console.log("yorumlar:",e),e?t(null,e):t("Review does not exist",null)}})}static PostReviewData(){const e=parseInt(getParameterByName("id")),t=document.getElementById("uname").value,n=parseInt(document.getElementById("rate").value),a=document.getElementById("subject").value;console.log("şş:",e),console.log("ş:",n);const r={restarant_id:e,name:t,rating:n,comments:a};fetch("http://localhost:1337/reviews/?restaurant_id="+e,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",body:JSON.stringify(r),redirect:"follow",referrer:"no-referrer",headers:{"content-type":"application/json; charset=utf-8"}}).then(e=>e.json()).then(e=>{console.log("PostedData:",e)}).catch(e=>{console.log(e)}),event.preventDefault()}static OfflinePostReviewData(){const e={restarant_id:parseInt(getParameterByName("id")),name:document.getElementById("uname").value,rating:parseInt(document.getElementById("rate").value),comments:document.getElementById("subject").value};alert(JSON.stringify(e)),event.preventDefault()}static fetchRestaurantById(e,t){DBHelper.fetchRestaurants((n,a)=>{if(n)t(n,null);else{const n=a.find(t=>t.id==e);n?(console.log("Rest:",n),t(null,n)):t("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(e,t){DBHelper.fetchRestaurants((n,a)=>{if(n)t(n,null);else{const n=a.filter(t=>t.cuisine_type==e);t(null,n)}})}static fetchRestaurantByNeighborhood(e,t){DBHelper.fetchRestaurants((n,a)=>{if(n)t(n,null);else{const n=a.filter(t=>t.neighborhood==e);t(null,n)}})}static fetchRestaurantByCuisineAndNeighborhood(e,t,n){DBHelper.fetchRestaurants((a,r)=>{if(a)n(a,null);else{let a=r;"all"!=e&&(a=a.filter(t=>t.cuisine_type==e)),"all"!=t&&(a=a.filter(e=>e.neighborhood==t)),n(null,a)}})}static fetchNeighborhoods(e){DBHelper.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].neighborhood),a=t.filter((e,n)=>t.indexOf(e)==n);e(null,a)}})}static fetchCuisines(e){DBHelper.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].cuisine_type),a=t.filter((e,n)=>t.indexOf(e)==n);e(null,a)}})}static urlForRestaurant(e){return`./restaurant.html?id=${e.id}`}static imageUrlForRestaurant(e){return`/img/${e.id}.jpg`}static mapMarkerForRestaurant(e,t){const n=new L.marker([e.latlng.lat,e.latlng.lng],{title:e.name,alt:e.name,url:DBHelper.urlForRestaurant(e)});return n.addTo(newMap),n}}let restaurant,review;var newMap;document.addEventListener("DOMContentLoaded",e=>{initMap()}),initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.newMap=L.map("map",{center:[t.latlng.lat,t.latlng.lng],zoom:16,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1IjoieWFsY2lub3MiLCJhIjoiY2ppYzJ2Nms0MDM0MTN3cGliaGhycnlmayJ9.VnwaAAVaCBS2TOyJ3M_6BQ",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(newMap),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.newMap))}),fetchReviewsFromURL((e,t)=>{e?console.error(e):console.log(t.name)})}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(t,n)=>{self.restaurant=n,n?(fillRestaurantHTML(),e(null,n)):console.error(t)}):(error="No restaurant id in URL",e(error,null))}),fetchReviewsFromURL=(e=>{if(self.review)return void e(null,self.review);const t=getParameterByName("id");t?DBHelper.fetchReviewsByRestaurantId(t,(t,n)=>{self.review=n,n?(fillReviewsHTML(),e(null,n)):console.error(t)}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{var t=["An Image of Mission Chinese Food Restaurant","An Image of Emily Restaurant","An Image of Kang Ho Dong Baekjeong Restaurant","An Image of Katz's Delicatessen Restaurant","An Image of Roberta's Pizza Restaurant","An Image of Hometown BBQ Restaurant","An Image of ImaSuperiority Burger Restaurant","An Image of The Dutch Restaurant","An Image of Mu Ramen Restaurant","An Image of Casa Enrique Restaurant"];document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address,document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type;const n=document.getElementsByTagName("picture"),a=document.createElement("img");a.id="restaurant-img",a.className="restaurant-imgs";const r=document.getElementsByTagName("source"),o=document.createElement("source");r[0].media="(min-width:1024px)",o.media="(min-width:480px)";for(var s=1;s<=10;s++)e.id==s&&(a.src="images/"+s+"-500_small.jpg",r[0].srcset=DBHelper.imageUrlForRestaurant(e),a.setAttribute("alt",t[s-1]),o.srcset="images/"+s+"-1000_medium.jpg");n[0].appendChild(o),n[0].appendChild(a),e.operating_hours&&fillRestaurantHoursHTML()}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const a=document.createElement("tr");a.tabIndex=0;const r=document.createElement("td");r.innerHTML=n,a.appendChild(r);const o=document.createElement("td");o.innerHTML=e[n],a.appendChild(o),t.appendChild(a)}}),fillReviewsHTML=((e=self.review)=>{const t=document.getElementById("reviews-container"),n=document.createElement("h2"),a=document.createElement("button"),r=document.getElementById("myModal"),o=document.getElementsByClassName("close")[0],s=document.getElementById("resid");if(a.onclick=function(){r.style.display="block"},o.onclick=function(){r.style.display="none"},window.onclick=function(e){e.target==r&&(r.style.display="none")},s.value=getParameterByName("id"),a.id="reviews-button",a.innerHTML="Add Review",n.innerHTML="Reviews",t.appendChild(n),t.appendChild(a),!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}const l=document.getElementById("reviews-list");console.log(typeof e),e.forEach(e=>{l.appendChild(createReviewHTML(e))}),t.appendChild(l)}),createReviewHTML=(e=>{const t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,n.classList.add("comment-username"),t.appendChild(n);const a=document.createElement("div");a.innerHTML=e.date,a.classList.add("reviews-date"),n.appendChild(a);const r=document.createElement("p");r.innerHTML=`Rating: ${e.rating}`,5===e.rating?r.style.background="#269900":4===e.rating?r.style.background="#39e600":3===e.rating?r.style.background="#e67300":r.style.background="#e60000",r.style.width="70px",r.style.color="white",r.style.borderRadius="5px",r.style.marginLeft="10px",r.style.fontWeight="bold",t.appendChild(r);const o=document.createElement("p");return o.innerHTML=e.comments,t.appendChild(o),t});const rewButton=document.getElementById("submitReview");rewButton.addEventListener("click",function(){if(window.navigator.onLine)DBHelper.PostReviewData();else{console.log("offline");const t={restarant_id:parseInt(getParameterByName("id")),name:document.getElementById("uname").value,rating:parseInt(document.getElementById("rate").value),comments:document.getElementById("subject").value};var e=JSON.stringify(t);addToLocalStorage(e),event.preventDefault()}location.href="http://localhost:8000/restaurant.html?id="+getParameterByName("id")}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}),addToLocalStorage=(e=>{parseInt(getParameterByName("id"));localStorage.setItem("reviewData",e)}),removeLocalStorageData=(()=>{localStorage.removeItem("reviewData")}),window.addEventListener("online",e=>{const t=parseInt(getParameterByName("id"));let n=JSON.parse(localStorage.getItem("reviewData"));fetch("http://localhost:1337/reviews/?restaurant_id="+t,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",body:JSON.stringify(n),redirect:"follow",referrer:"no-referrer",headers:{"content-type":"application/json; charset=utf-8"}}).then(e=>e.json()).then(e=>{console.log("LocalStorageData:",e),removeLocalStorageData()}).catch(e=>{console.log(e)})});