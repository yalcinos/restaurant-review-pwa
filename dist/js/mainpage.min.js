class DBHelper{static fetchRestaurants(e){fetch("http://localhost:1337/restaurants").then(function(e){return e.json()}).then(function(t){e(null,t),console.log("Sucess:",t)})}static fetchReviews(e){fetch("http://localhost:1337/reviews").then(function(e){return e.json()}).then(function(t){console.log("Review:",t),e(null,t)})}static fetchReviewsByRestaurantId(e,t){DBHelper.fetchReviews((e,n)=>{if(e)t(e,null);else{let e=n.filter(e=>e.restaurant_id==getParameterByName("id"));console.log("yorumlar:",e),e?t(null,e):t("Review does not exist",null)}})}static PostReviewData(){const e=parseInt(getParameterByName("id")),t=document.getElementById("uname").value,n=parseInt(document.getElementById("rate").value),a=document.getElementById("subject").value;console.log("şş:",e),console.log("ş:",n);const s={restarant_id:e,name:t,rating:n,comments:a};fetch("http://localhost:1337/reviews/?restaurant_id="+e,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",body:JSON.stringify(s),redirect:"follow",referrer:"no-referrer",headers:{"content-type":"application/json; charset=utf-8"}}).then(e=>e.json()).then(e=>{console.log("PostedData:",e)}).catch(e=>{console.log(e)}),event.preventDefault()}static OfflinePostReviewData(){const e={restarant_id:parseInt(getParameterByName("id")),name:document.getElementById("uname").value,rating:parseInt(document.getElementById("rate").value),comments:document.getElementById("subject").value};alert(JSON.stringify(e)),event.preventDefault()}static fetchRestaurantById(e,t){DBHelper.fetchRestaurants((n,a)=>{if(n)t(n,null);else{const n=a.find(t=>t.id==e);n?(console.log("Rest:",n),t(null,n)):t("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(e,t){DBHelper.fetchRestaurants((n,a)=>{if(n)t(n,null);else{const n=a.filter(t=>t.cuisine_type==e);t(null,n)}})}static fetchRestaurantByNeighborhood(e,t){DBHelper.fetchRestaurants((n,a)=>{if(n)t(n,null);else{const n=a.filter(t=>t.neighborhood==e);t(null,n)}})}static fetchRestaurantByCuisineAndNeighborhood(e,t,n){DBHelper.fetchRestaurants((a,s)=>{if(a)n(a,null);else{let a=s;"all"!=e&&(a=a.filter(t=>t.cuisine_type==e)),"all"!=t&&(a=a.filter(e=>e.neighborhood==t)),n(null,a)}})}static fetchNeighborhoods(e){DBHelper.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].neighborhood),a=t.filter((e,n)=>t.indexOf(e)==n);e(null,a)}})}static fetchCuisines(e){DBHelper.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].cuisine_type),a=t.filter((e,n)=>t.indexOf(e)==n);e(null,a)}})}static urlForRestaurant(e){return`./restaurant.html?id=${e.id}`}static imageUrlForRestaurant(e){return`/img/${e.id}.jpg`}static mapMarkerForRestaurant(e,t){const n=new L.marker([e.latlng.lat,e.latlng.lng],{title:e.name,alt:e.name,url:DBHelper.urlForRestaurant(e)});return n.addTo(newMap),n}}let restaurants,neighborhoods,cuisines;var newMap,markers=[];let countFav=1,ct=1;document.addEventListener("DOMContentLoaded",e=>{initMap(),fetchNeighborhoods(),fetchCuisines()}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods((e,t)=>{e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})}),fetchCuisines=(()=>{DBHelper.fetchCuisines((e,t)=>{e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})}),initMap=(()=>{self.newMap=L.map("map",{center:[40.722216,-73.987501],zoom:12,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1IjoieWFsY2lub3MiLCJhIjoiY2ppYzJ2Nms0MDM0MTN3cGliaGhycnlmayJ9.VnwaAAVaCBS2TOyJ3M_6BQ",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(newMap),updateRestaurants()}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,a=t.selectedIndex,s=e[n].value,r=t[a].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(s,r,(e,t)=>{e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),addMarkersToMap()}),createRestaurantHTML=(e=>{var t=["An Image of Mission Chinese Food Restaurant","An Image of Emily Restaurant","An Image of Kang Ho Dong Baekjeong Restaurant","An Image of Katz's Delicatessen Restaurant","An Image of Roberta's Pizza Restaurant","An Image of Hometown BBQ Restaurant","An Image of ImaSuperiority Burger Restaurant","An Image of The Dutch Restaurant","An Image of Mu Ramen Restaurant","An Image of Casa Enrique Restaurant"];const n=document.createElement("li"),a=document.createElement("picture"),s=document.createElement("source"),r=document.createElement("source"),o=document.createElement("img");o.className="restaurant-imgs",s.media="(min-width:1024px)",r.media="(min-width:480px)";for(var l=1;l<=10;l++)e.id==l&&(o.id="restaurant"+l+"-img",o.src="images/"+l+"-500_small.jpg",s.srcset=DBHelper.imageUrlForRestaurant(e),r.srcset="images/"+l+"-1000_medium.jpg",o.alt=t[l-1]);n.append(a),a.append(s),a.append(r),a.append(o);const i=document.createElement("h2");i.innerHTML=e.name,n.append(i);const c=document.createElement("p");c.innerHTML=e.neighborhood,n.append(c);const u=document.createElement("p");u.innerHTML=e.address,n.append(u);const d=document.createElement("a");d.innerHTML="View Details",d.href=DBHelper.urlForRestaurant(e),n.append(d);const m=document.createElement("div"),h=document.createElement("img");return h.className="fav-icon",h.setAttribute("id",ct),ct++,"true"===e.is_favorite?(h.src="img/like.svg",h.alt="Favorite-Button"):h.src="img/heart.svg",h.align="right",h.alt="Favorite-Button",h.addEventListener("click",function(){if(1==countFav){h.src="img/like.svg",countFav=0,console.log(e.id);for(let t=1;t<=10;t++)e.id==t&&fetch("http://localhost:1337/restaurants/"+t+"/?is_favorite=true",{method:"PUT"}).then(function(e){return e.json()})}else{h.src="img/heart.svg",countFav=1;for(let t=1;t<=10;t++)e.id==t&&fetch("http://localhost:1337/restaurants/"+t+"/?is_favorite=false",{method:"PUT"}).then(function(e){return e.json()})}}),m.appendChild(h),n.append(m),n}),addMarkersToMap=((e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.newMap);t.on("click",function(){window.location.href=t.options.url})})});